const u=/\b(Mr|Mrs|Ms|Dr|Prof|Sr|Jr|St)\.$/;function d(n){const t=[];let e=0;const s=n.split(/(\s+)/);let o="";if(s.forEach(r=>{if(o+=r,/[.!?]$/.test(r)&&!u.test(o.trim())){const c=o.trim(),i=c.split(/\s+/).filter(Boolean);t.push({text:c,start:e,end:e+c.length,words:i}),e+=o.length,o=""}}),o.trim().length>0){const r=o.trim(),c=r.split(/\s+/).filter(Boolean);t.push({text:r,start:e,end:e+r.length,words:c})}return t}function f(n){const t=n.toLowerCase().replace(/[^a-z]/g,"");if(!t)return 0;const e={the:1,apple:2,people:2,queue:1};if(e[t])return e[t];const s=t.match(/[aeiouy]+/g);return s?s.length:1}function p(n){const t=n.flatMap(i=>i.words),e=t.length||1,s=n.length||1,o=t.reduce((i,l)=>i+f(l),0),r=206.835-1.015*(e/s)-84.6*(o/e),c=4.71*(t.join("").length/e)+.5*(e/s)-21.43;return{fleschKincaid:r,ari:c}}const h=/\b(am|is|are|was|were|be|been|being)\b/i,b=/\b\w+(ed|en)\b/i;function g(n){const t=[];return n.forEach((e,s)=>{h.test(e.text)&&b.test(e.text)&&t.push({sentence:e.text,index:s})}),t}function a(n){const t=[];return n.forEach((e,s)=>{e.words.forEach(o=>{const r=o.toLowerCase();r.endsWith("ly")&&!/(family|supply|reply|apply)$/.test(r)&&t.push({word:o,sentenceIndex:s})})}),t}function m(n){const t=n.flatMap(s=>s.words);return t.length===0?0:a(n).length/t.length}function y(n){const t=d(n),e=p(t),s=g(t),o=a(t),r=m(t);return{sentences:t,readability:e,passiveVoice:s,adverbs:o,adverbDensity:r}}self.onmessage=n=>{const{text:t,job:e}=n.data;try{const s=y(t);self.postMessage({ok:!0,result:s,job:e})}catch(s){self.postMessage({ok:!1,error:String(s),job:e})}};
